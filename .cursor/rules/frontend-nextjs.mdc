---
description: Next.js 15 frontend patterns, API proxy, and SSE
globs: frontend/**/*
alwaysApply: false
---

# Frontend (Next.js 15)

**Flows:** `.cursor/rules/diagrams.mdc` (user journey, execution sequence, REST vs SSE). Use `.cursor/skills/nextjs-app-router-patterns` for App Router and Server Component patterns.

## Structure

- `app/page.tsx` – Landing. `app/layout.tsx` – root layout with sidebar.
- `app/dashboard/`, `app/tests/`, `app/tests/create/`, `app/tests/[id]/`, `app/runs/`, `app/results/[id]/`.
- `app/api/*` – proxy to FastAPI only; no direct FastAPI URL for REST.
- `components/` – Sidebar, TestForm, TestTable, ResultsView, LiveLogStream. Use `components/ui/` for shadcn.

## Data & API

- **Reads**: Server Components fetch from NeonDB via `@neondatabase/serverless` (dashboard, test list, test detail, run history). No writes from Next.js.
- **Writes**: Client components call Next.js API routes (e.g. `POST /api/tests`, `POST /api/test/run`). API routes proxy to FastAPI and forward errors in a consistent format.
- **SSE**: Results page uses `EventSource` to FastAPI `/results/{run_id}/stream`. Support reconnect and optional `Last-Event-ID` for resume. Parse JSON: `type`, `timestamp`, `data` (log, screenshot, complete, error).

## UX Requirements

- Sidebar: Dashboard, Create Test, All Tests, Recent Runs; collapsible.
- After "Save Test" → redirect to Test Detail. After "Run Test" → redirect to `/results/{run_id}` with live log stream.
- Results: hero Pass/Fail badge, metrics (duration, cost, LLM calls), step timeline with screenshots, expandable self-healing details, "Run Again" / "Back to Test" / "Edit Test".
- Empty dashboard: onboarding wizard with "Create Your First Test" → Create Test page.

## Conventions

- Use Server Components by default; Client Components for forms, SSE, and interactive UI.
- English for all code, comments, and UI strings. Tailwind for styling.
